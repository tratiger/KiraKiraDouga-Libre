# Markdown 拡張構文

## 基本構文

### テキストフォーマット
<table>
<td>

```markdown
*斜体*
**太字**
***太字斜体***
~~取り消し線~~
`インラインコード`
$$インライン数式$$
```

</td>
<td>

*斜体*\
**太字**\
***太字斜体***\
~~取り消し線~~\
`インラインコード`\
$$インライン数式$$

</td>
</table>

### 段落フォーマット
<table>
<td>

````markdown
# 見出し1
## 見出し2
### 見出し3
#### 見出し4
##### 見出し5
###### 見出し6
> 引用
> > 入れ子引用

    インデント
* 順序なしリスト
  * インデント付き順序なしリスト（インデントにはスペース2つまたはタブ1つを使用）
- その他の順序なしリスト記号 (-)
+ その他の順序なしリスト記号 (+)
1. 順序付きリスト（前の数字は任意）
   1. インデント付き順序付きリスト
- [ ] 未完了タスク
- [x] 完了済みタスク

``` 言語名
ブロックコード
```

$$
中央揃え数式
$$
````

</td>
<td>

# 見出し1
## 見出し2
### 見出し3
#### 見出し4
##### 見出し5
###### 見出し6
> 引用
> > 入れ子引用

    インデント
* 順序なしリスト
  * インデント付き順序なしリスト（インデントにはスペース2つまたはタブ1つを使用）
- その他の順序なしリスト記号 (-)
+ その他の順序なしリスト記号 (+)
1. 順序付きリスト（前の数字は任意）
   1. インデント付き順序付きリスト
- [ ] 未完了タスク
- [x] 完了済みタスク

``` 言語名
ブロックコード
```

$$
中央揃え数式
$$

</td>
</table>

### 機能
```markdown
[リンク名](リンク先アドレス)
![画像の説明](画像アドレス)
```

### エスケープ
各種Markdown記号の前にバックスラッシュを追加するとエスケープされます。例：
<table>
<td>

```markdown
\*\*太字を無視\*\*
\# 見出しを無視
\`インラインコードを無視\`
!\[画像を無視](#)
\![感嘆符とリンクが出力されます](#)
\\ バックスラッシュを一つ出力
```

</td>
<td>

\*\*太字を無視\*\*\
\# 見出しを無視\
\`インラインコードを無視\`\
!\[画像を無視](#)\
\![感嘆符とリンクが出力されます](#)\
\\ バックスラッシュを一つ出力\

</td>
</table>

Unicode文字の出力については、HTMLネイティブがUnicode文字エンコーディングをサポートしているため、多くのプログラミング言語で使われる `\u` で始まる構文は使用しません。
```html
&#x4e00; Unicode文字 U+4E00「一」を出力
&#x1f010; Unicode文字 U+1F010「🀐」を出力
```

### 水平線
3つ以上のハイフンで表現します。
```markdown
---
```
---

### メンション
```markdown
@誰か の後にスペース
```

### ハッシュタグ
```markdown
#シャープ記号で内容を囲む#
```
タグリンクとしてレンダリングされ、クリックするとそのタグ/キーワード/kv番号を検索します。

## 一般的に認知されている拡張構文

### テキストフォーマット
<table>
<td>

```markdown
テキスト^上付き^
テキスト~下付き~
```

</td>
<td>

```html
テキスト<sup>上付き</sup>
テキスト<sub>下付き</sub>
```

</td>
<td>
<p>テキスト<sup>上付き</sup></p>
<p>テキスト<sub>下付き</sub></p>
</td>
</table>

### 脚注
> 廃止可能。現在の用途では脚注はあまり意味がありません。
```markdown
脚注を挿入できます[^1]、そしてもう一つ[^長い脚注]。
[^1]: 脚注です。
[^長い脚注]: 複数行の

脚注。
```

### 定義リスト
> 廃止可能。インデントで代替できます。
<table>
<td>

```markdown
用語
: 説明
用語
: 説明
```

</td>
<td>

```html
<dl>
	<dt>用語</dt>
	<dd>説明</dd>

	<dt>用語</dt>
	<dd>説明</dd>
</dl>
```

</td>
<td>
<dl>
<dt>用語</dt>
<dd>説明</dd>
<dt>用語</dt>
<dd>説明</dd>
</dl>
</td>
</table>

### 略語
> 廃止可能。ツールチップテンプレートで代替できます。
```markdown
*[HTML]: Hyper Text Markup Language
*[W3C]:  World Wide Web Consortium

HTML仕様はW3Cによって維持されています。
```

### 絵文字
> 廃止可能。入力メソッドから直接対応する記号を挿入できます。
```markdown
:絵文字の英語名:
```

### 挿入
> 廃止可能。下線で代替できます。
<table>
<td>

```markdown
++挿入++
```

</td>
<td>

```html
<ins>挿入</ins>
```

</td>
<td>
<ins>挿入</ins>
</td>
</table>

### マーカー/ハイライト
<table>
<td>

```markdown
==ハイライト==
```

</td>
<td>

```html
<mark>ハイライト</mark>
```

</td>
<td>
<mark>ハイライト</mark>
</td>
</table>

## 新しく追加・変更された拡張構文

### テキストフォーマット
<table>
<td>

```markdown
_下線_
```

</td>
<td>

```html
<u>下線</u>
```

</td>
<td>
<u>下線</u>
</td>
</table>
オリジナル版には下線表現がなく、この記号は斜体を意味します。

### 段落フォーマット
* インデントに使用するスペース数を統一。現行版では、純粋なインデント、順序なしリストのインデント、順序付きリストのインデントに必要なスペース数がそれぞれ4、2、3でしたが、2に統一します。
<table>
<td>

```markdown
    インデント
* 順序なしリスト
  * インデント付き順序なしリスト
1. 順序付きリスト
   1. インデント付き順序付きリスト
```

</td>
<td>

```markdown
  インデント
* 順序なしリスト
  * インデント付き順序なしリスト
1. 順序付きリスト
  1. インデント付き順序付きリスト
```

</td>
</table>

### コメント
HTML構文は無効化されていますが、コメントの構文は保持されます。つまり：
```html
<!-- -->
```
なぜ他のプログラミング言語で一般的な `//` や `/* */` 構文を使わないのか？移植性を高めたいからです。

### 改行
1つの改行で改行を表します。オリジナル版では、2つの改行で1つの段落（下にマージンあり）を表すか、2つのスペース+1つの改行で改行（末尾のスペースは見つけにくく、EditorConfigによって消されやすい）を表す必要がありました。オリジナル版で1つの改行を使用すると、スペースが1つ出力されるだけです。

### 句読点付近でのMarkdown記号の使用
オリジナル版では、句読点の**外側**でMarkdown記号（太字など）を使用すると、Markdown構文が無効になることがありました。例：
```markdown
**Note:** 英語のコロンは太字成功！
**注意：**中国語のコロンは太字失敗！
```
**効果：**

> **Note:** 英語のコロンは太字成功！\
> **注意：**中国語のコロンは太字失敗！

中国語のコロンの後にも英語のコロンのようにスペースを追加すると、コロンの後の空白が広すぎます。

そのため、この東アジア言語に優しくない仕様は廃止することを提案します。

### エスケープ
バックスラッシュによるエスケープ機能を追加。
* 行末にバックスラッシュを置くと、オリジナル版Markdownの改行メカニズムに戻り、改行せずにスペースが挿入されます。
* `\ `とすると、`<wbr />`が挿入され、構文が曖昧になる可能性のある場所に区切りを入れられます（reStructuredTextを参考にしました）。
* オリジナル版のインラインコード内では、他のすべてのスタイル記号は無効化され、そのまま表示されます。現在はインラインコード内でも他のスタイル記号が使用できます。スタイル記号を使わずに純粋なテキストを保持したい場合は、3つ以上のバッククォート ````` ``` ```` を使用し、終了時にも同じ数のバッククォートを使用します。これにより、バックスラッシュやバッククォートを含む純粋なテキストがそのまま保持されます。

### ブロックスタイル（クラスとID）
MarkdownエディタにCSSスタイルを設定するためのタブを追加します。これにより、Markdownインターフェースで段落ごとにクラス名を指定できます。

ユーザー指定のクラス名が優先され、次にシステムプリセットのクラス名が使用されます。以下の例はシステムプリセットのクラス名です。
```markdown
# {.center} 中央揃えの見出し
# {.right} 右揃えの見出し
{.justify} 両端揃えのテキスト
```

中括弧の内外のスペースは問いません。

段落にID名を指定することもできます。CSSで#セレクタとしてマッチさせるだけでなく、アンカーとしても機能します。例：
```markdown
{#top} おかえりなさい！
```
そして、他の場所でリンクを使用すれば、この段落に素早く戻ることができます。
```markdown
[トップに戻る](#top)
```

### MediaWiki風テンプレート
> この部分の内容は実装が非常に困難なため、廃止せざるを得ませんでした。

<s>
MediaWikiに似たテンプレート構文を引用して、開発者が組み込んだVueコンポーネントを表します。
<table>
<td>

```mediawiki
{{kbd|キーボードのキー}}
{{blocktext|黒塗りテキスト|マウスオーバーテキスト|カラーマスクの色}}
{{ruby|ふりがな|pīnyīn|オプションの左括弧文字|オプションの右括弧文字}}
{{tooltip|テキスト|ツールチップテキスト}}
{{color|テキスト|文字色|背景色}}
{{attr|インラインテキスト|#foo.bar.baz}}
```

</td>
<td>

```html
<kbd>キーボードのキー</kbd>
<BlockText tooltip="マウスオーバーテキスト" color="カラーマスクの色">黒塗りテキスト</BlockText>
<ruby>ふりがな<rp>オプションの左括弧文字</rp><rt>pīnyīn</rt><rp>オプションの右括弧文字</rp></ruby>
<span title="ツールチップテキスト">テキスト</span>
<span style="color: 文字色; background-color: 背景色;">テキスト</span>
<span id="foo" class="bar baz">インラインテキスト</span>
```

</td>
</table>
<!-- MediaWiki異端はMarkdownから出ていけ（ -->
</s>

### キーボードキー
<table>
<td>

```markdown
`|Ctrl|`
```

</td>
<td>

```html
<kbd>Ctrl</kbd>
```

</td>
<td>
<kbd>Ctrl</kbd>
</td>
</table>

### 黒塗り（ネタバレ防止）
萌娘百科の黒塗り（block text）とTelegramのネタバレ防止（spoiler）を参考にしています。

<table>
<td>

```markdown
!!黒塗り!!
```

</td>
<td>

```html
<kira-spoiler>黒塗り</kira-spoiler>
```

</td>
</table>

### 色
この構文は簡書（Jianshu）のテキストカラー構文を参考にしています。

中括弧の内側のスペースは問いませんが、外側は問います。

```markdown
$color{red}赤色テキスト$
```

```html
<span style="color: red;">赤色テキスト</span>
```

<span style="color: red;">赤色テキスト</span>

テキストの背景色の変更もサポートしています。

```markdown
$color{red|lime}赤色テキスト$
```

```html
<span style="color: red; background-color: lime;">テキスト</span>
```

<span style="color: red; background-color: lime;">テキスト</span>

### インラインスタイル（クラスとID）
インラインテキストにCSSスタイルを設定します。

```markdown
$attr{#foo.bar.baz}テキスト$
```

```html
<span id="foo" class="bar baz">テキスト</span>
```

classは複数指定できますが、idは1つしか指定できません。

### [汎用ディレクティブ構文](https://talk.commonmark.org/t/generic-directives-plugins-syntax/444)
> [インスピレーション元](https://blog.kaciras.com/article/18/add-video-support-to-markdown)

#### 標準フォーマット
```markdown
!名前[説明](アドレス){属性}
```

例
```markdown
!video[alt text](my_video.mp4){#id.class controls key=val key2="val 2"}
```
効果
```html
<video src="my_video.mp4" id="id" class="class" controls key="val" key2="val 2">alt text</video>
```

#### 高度なフォーマット
```markdown
!!!名前[説明](アドレス){属性}
詳細情報
!!!
```

#### 名前
これが何の要素であるかを示すために使用します。省略された場合は、デフォルトで画像要素として扱われ、標準のMarkdownと一致します。

#### 説明
代替テキストやタイトル（利用可能な場合）などを表すために使用します。説明がない場合でも、角括弧を省略せず、空の角括弧を保持する必要があります。

#### 属性
属性を表すために、JSONに似たキーと値のペアの形式を使用します。項目はスペースで区切り、キーと値の区切りには等号を使用します。値が1つの単語の場合は引用符を省略できますが、値の内容が複雑な場合は引用符で囲む必要があります。項目がブール型（値がない場合）の場合は、値を省略してキー名だけで表現できます。キー名に `.` または `#` 記号が含まれている場合は、クラスおよびIDとして認識され、要素にclassおよびid属性が追加されます。これらは別々に書くことも、組み合わせて書くこともでき、`{#foo.bar.baz}` `{.bar#foo.baz}` `{#foo .bar .baz}` の効果は同じです。別々に書いた場合、同じものに遭遇すると、クラス名はマージされ、IDは後者で上書きされます。

属性がない場合は、中括弧ごと省略できます。

### カード
#### リンクカード
```markdown
!linkcard[リンクカードテキスト](リンクアドレス)
```

これはハイパーリンクをインライン要素からブロック要素に変換し、長いカードとして表示されることに注意してください。

#### ビデオカード
リンクカードと同様に、これもブロック要素です。長いカードとして表示されます。
```markdown
!linkcard[ビデオカードタイトル](KV番号)
```

#### ビデオタイル
ビデオカードに似ていますが、これはグリッドタイルとして表示されるインラインブロック要素（inline-block）です。
```markdown
!videotile[ビデオタイルタイトル](KV番号)
```

### ビデオプレーヤー
ユーザーが個人のホームページにビデオプレーヤーを配置し、指定した複数のビデオ/ユーザーの全ビデオ/特定の公開コレクションをランダムに再生できるようにします。

````json5
```json video-player
{
	"video": "kv1", // ここにビデオアドレスを配置します。
	"autoplay": false, // ミュートで自動再生するかどうか、デフォルトは false。
	"order": "loop", // 再生方法、デフォルトは loop。
}
```
````

#### 再生方法
* `loop` 全てループ
* `shuffle` ランダムループ

から1つを選択できます。

#### 指定した複数のビデオを再生
```json5
{
	"video": [
		"kv1",
		"kv2",
		"kv3",
	],
}
```

#### 全てのビデオ
```json5
{
	"video": true,
}
```

#### コレクション
コレクションなどの番号プレフィックスについては、[こちらを参照してください](numbering-prefix.md)。
```json5
{
	"video": "kl10086",
}
```

### テーブル
**テーブル機能の構文は現在議論中です。Markdownの構文はあまり使いやすくなく、reStructuredTextはさらに使いにくいです。MediaWikiのテーブル構文を使用するアイデアはありますが、目的は入力をより便利にすることであり、プレビュー効果と一致させることではありません。そうでなければ、列の追加やセルの結合が非常に面倒になります。**

## 廃止された機能

### 制限
* HTML構文のサポートを停止し、入力されると純粋なテキストにエスケープされます。<ruby>XSS<rt>小学生</rt></ruby>攻撃に注意してください。
  * ただし、コメントは保持されます。
* CSSエディタでは、ユーザーが画像を介して悪意のあるコードを読み込むのを防ぐため、`url()`関数に制限をかけます（完全に無効にするのは良くありません）。
* 単一のアンダースコア文字でテキストを囲むと下線機能に置き換えられ、オリジナル版のアンダースコア文字が表していた<table><tr><td>`_斜体_`</td><td>_斜体_</td></tr><tr><td>`__太字__`</td><td>__太字__</td></tr></table>などの機能はキャンセルされます。
* 多対一の構文を廃止します。例：
  * `*` と `_` でテキストを囲むと***太字、斜体***効果が得られましたが、`_` を廃止し、`*` の構文のみを保持します。
  * 前置 `#` と下置 `====` の両方で見出し機能が実現できましたが、後者を廃止します。
  * 意味論ではなく、視覚的な体験のみを考慮します。HTMLには多くの意味論的なタグが元々あり、アクセシビリティリーダーにとってはより良い体験になる可能性があります。例：<u>`<ins>` タグと `<u>` の視覚効果は同じ</u>、<i>`<var>` タグと `<em>/<i>` の視覚効果は同じ</i>。この場合、わざわざ別の構文を追加する必要はないと感じます。
  * ただし、順序なしリストの記号は例外で、`*` `+` `-` はいずれも使用できます。
